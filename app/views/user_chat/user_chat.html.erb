<header>
  <div class = "general">
    <div class="left">
      <div class = "hello">
        <h3 class="user"><%= current_user.email%></h3>
      </div>
    </div>
    <div class="right">
      <div class = "link">
        <%= link_to 'Exit', destroy_user_session_path, data: {confirm: "Are you sure?"}, :method => :delete %>
      </div>
      <div class = "link">
        <%= link_to 'Go back', root_path %>
      </div>
    </div>
  </div>
</header>

<div class="for_all">
  <div class="output">
    <div class="name">
      <h3><%= @user.email %></h3>
    </div>
    <div class="messages">
      <div class="our_messages">
        <% if @your_messages.nil? && @my_messages.nil? %>
          <div class="dialog">
            <h1>Dialog is clear</h1>
          </div>
        <% else %>
          <% @your_messages.each do |your| %>
            <div class="your lefter" data-user_id=<% @user.id %> >
              <div class="message lefter">
                <p class="text"><%= your.body %></p>
              </div>
            </div>
          <% end %>
            <% @my_messages.each do |my| %>
              <div class="my">
                <div class="message righter">
                  <p class="text"><%= my.body %></p>
                </div>
              </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
  <div class="input">
    <%= form_for :message, url: user_create_path do |f| %>
      <p>
        Message<br>
        <%= f.text_field :body%>
        <%= f.hidden_field :user_id, value: @user.id %>
      </p>

      <p>
        <%= f.submit 'Send', class: "btn btn-primary"%>
      </p>
    <% end %>
  </div>
</div>

<script>

    const div = document.getElementById("lefter")
    const user_id = div.dataset.user_id

     setInterval(() => fetch('http://localhost:3000/user_chat?user_id').then((response) => {
         response.json();
         console.log(response);
     }), 2000);

</script>